<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ST7789 Digital Clock</title>
  <link href="css/main.css" rel="stylesheet">
  <link href="css/about.css" rel="stylesheet">
  <link href="css/projects.css" rel="stylesheet">
  <link href="css/focus-detail.css" rel="stylesheet">





  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;300;400;500;600;700;800&display=swap"
    rel="stylesheet">
</head>

<body>

  <header>

    <div class="container header-container">
      <a href="index.html" class="logo-link">
        <img class="logo-image" src="image/logo2.webp" alt="Logo composed of a laptop icon and my name" width="120"
          height="46">
      </a>

      <nav>
        <a href="./index.html#aboutme" class="nav-button">About me</a>
        <a href="./index.html#projects" class="nav-button">Projects</a>
        <a href="./index.html#contact" class="nav-button">Contact</a>

      </nav>
    </div>


  </header>

  <section id="project">
    <div class="details-ct">


      <div class="project-intro">
        <div class="title-and-tag">
          <h1>ST7789 Clock</h1>
          <div class="type-tag web-tag">Efmbedded System</div>
        </div>

        <div class="desc-and-link">

          <p> I attemped to build my own DIY desk clock with using STM32 microcontroller, LCD module and a weather
            sensor</p>
          <div class="link-ct">
            <a href="https://github.com/nhanvyn/st7789-digital-clock" target="_blank" class="btn-link btn-sm">
              <!-- Credit to Lucide icon: https://lucide.dev/icons/square-arrow-out-up-right -->
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-square-arrow-out-up-right">
                <path d="M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6" />
                <path d="m21 3-9 9" />
                <path d="M15 3h6v6" />
              </svg>
              <span>Code link</span>
            </a>

          </div>
        </div>
      </div>

      <div class="text-collection">
        <div class="long-text">
          <h2>
            Project Overview
          </h2>
          <!-- <p>
                    This project was the final project for my university Information Design course. CarnavalDelSol is a microsite for the Carnaval Del Sol food festival, showcasing South American food vendors. The original festival’s website lacked vendor details, missing an opportunity to engage visitors. This microsite bridges that gap by providing an engaging and informative platform.
                   </p>
                    -->
          <p>
            This project was inspired by
            <a href="https://www.youtube.com/watch?v=35zs2J3Prxo" target="_blank">
              The Wrench’s DIY Mini Desk Clock
            </a>.
           After watching it, I wanted to create something similarly cool while also using it as an 
           opportunity to learn embedded communication protocols like SPI and I²C.
            The project was developed in C using the STM32 HAL library.
          </p>

        </div>

        <div class="long-text">
          <h2>
            Weather sensor
          </h2>
          <p>
            The BME280 sensor transmits temperature data via the I²C protocol using the SCL (clock) and SDA (data)
            lines.
            By default, the sensor is in sleep mode and must be activated by writing to the control measurement register
            with specific values defined in Bosch’s datasheet.
            Each BME280 unit is uniquely calibrated at the factory, so its raw readings must be adjusted using the
            sensor’s built-in calibration coefficients to obtain accurate temperature values.
          </p>
        </div>

        <div class="long-text">
          <h2>
            LCD screen
          </h2>
          <p>
            The ST7789 LCD communicates with the STM32 via the MOSI line,
            I used a logic analyzer with PulseView to inspect the SPI signals, but configuring it correctly was tricky
            at first.
            SPI standards vary across tools — for example, CubeMX uses CPHA = 1 or 2, while PulseView uses CPHA = 0 or
            1.
            I initially set CPHA = 1 in PulseView (thinking it meant "sample on falling edge" like in Cube), but the
            mismatch caused corrupted data.




          </p>


        </div>

        <div class="long-text">
          <h2>
            Memory Limitation
          </h2>
          <p>
            The first challenge was to find a way to get animation displayed correctly. I used <a
              href="ezgif.com" target="_blank"> ezgif</a> to
            convert GIF into multiple 240x240 PNG images, and then used python to convert each frame into a array of
            240x240 16 bits pixels. Due the the limit of 512kb of Flash memory
            I can only load 3-4 frames of 112.5 kb each in main(). This was enough to show a moving animation in the
            background, but with only a few frames spaced apart, the motion appeared very fast and choppy.


          </p>


        </div>

        <div class="long-text">
          <h2>
            Big endian coversion
          </h2>
          <p>
            A tricky bug I ran into was forgetting to account for endianness when sending image data from the STM32 to
            the LCD. STM32 uses little-endian format, while the ST7789 LCD expects big-endian.
            As a result, each 16-bit pixel (in uint16_t) was split into two bytes and transmitted in the wrong order
            over SPI, causing the image to appear glitchy and distorted <strong>(Image 2)</strong>. I fixed this by swapping the 
            byte order of each pixel before sending the frame buffer to the LCD.
          </p>

        </div>

        <div class="long-text">
          <h2>
            Things to implement next
          </h2>
          <div>
           
              <p>
               I plan to add a MicroSD module to store animation frames externally, allowing for smoother frame streaming without relying on limited Flash memory.
                After that, I’ll solder header pins to the LCD module to replace the Dupont wires, which occasionally cause data corruption due to poor signal integrity at higher SPI clock speeds.
              </p>
           
          </div>


        </div>

      </div>

      <div class="project-imgs-wrap sticky">

        <div class="project-imgs-container">
          <figure>
            <img src="./image/breadboard.webp" alt="Image of three iterations of the CarnavalDelSol web page"
              class="linked-image" width="475" height="331">
            <figcaption><strong>Image 1: </strong>Wiring with breadboard</figcaption>
          </figure>
          <figure>
            <img src="./image/endian.webp" alt="Image of final website on dekstop and mobile" class="linked-image"
              width="475" height="301">
            <figcaption><strong>Image 2: </strong>Glitchy image bug</figcaption>
          </figure>
          <figure>
            <img src="./image/st7789.webp" alt="Image of final website on dekstop and mobile" class="linked-image"
              width="475" height="301">
            <figcaption><strong>Image 3: </strong> Final result</figcaption>
          </figure>
        </div>
      </div>

    </div>


  </section>



  <footer>
    <div class="footer-container">
      <section id="contact" class="footer-contact">
        <h2>Contact Me</h2>
        <div class="contact-desc">
          <p>Feel free to contact me if you have any question or want to collaborate</p>
        </div>
        <div class="email-ct">
          <!-- open user email program: https://www.w3schools.com/tags/tryit.asp?filename=tryhtml_link_mailto -->
          <a href="mailto:nhanvyn99@gmail.com" target="_blank" class="social-link" aria-label="nhanvyn@sfu.ca">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
              stroke="#B8CABA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="lucide lucide-mail">
              <rect width="20" height="16" x="2" y="4" rx="2" />
              <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7" />
            </svg>
            <span>nhanvyn@sfu.ca</span>
          </a>
        </div>



        <div class="social-ct">
          <!-- SVG code for icons credit to Flowbite: https://flowbite.com/icons/ -->
          <a href="https://github.com/nhanvyn" target="_blank" class="social-link" aria-label="GitHub Profile">
            <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
              width="32" height="32" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd"
                d="M12.006 2a9.847 9.847 0 0 0-6.484 2.44 10.32 10.32 0 0 0-3.393 6.17 10.48 10.48 0 0 0 1.317 6.955 10.045 10.045 0 0 0 5.4 4.418c.504.095.683-.223.683-.494 0-.245-.01-1.052-.014-1.908-2.78.62-3.366-1.21-3.366-1.21a2.711 2.711 0 0 0-1.11-1.5c-.907-.637.07-.621.07-.621.317.044.62.163.885.346.266.183.487.426.647.71.135.253.318.476.538.655a2.079 2.079 0 0 0 2.37.196c.045-.52.27-1.006.635-1.37-2.219-.259-4.554-1.138-4.554-5.07a4.022 4.022 0 0 1 1.031-2.75 3.77 3.77 0 0 1 .096-2.713s.839-.275 2.749 1.05a9.26 9.26 0 0 1 5.004 0c1.906-1.325 2.74-1.05 2.74-1.05.37.858.406 1.828.101 2.713a4.017 4.017 0 0 1 1.029 2.75c0 3.939-2.339 4.805-4.564 5.058a2.471 2.471 0 0 1 .679 1.897c0 1.372-.012 2.477-.012 2.814 0 .272.18.592.687.492a10.05 10.05 0 0 0 5.388-4.421 10.473 10.473 0 0 0 1.313-6.948 10.32 10.32 0 0 0-3.39-6.165A9.847 9.847 0 0 0 12.007 2Z"
                clip-rule="evenodd" />
            </svg>

          </a>
         <a href="https://www.linkedin.com/in/nhanvyn/" target="_blank" class="social-link"
            aria-label="LinkedIn Profile">
            <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
              width="33" height="33" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd"
                d="M12.51 8.796v1.697a3.738 3.738 0 0 1 3.288-1.684c3.455 0 4.202 2.16 4.202 4.97V19.5h-3.2v-5.072c0-1.21-.244-2.766-2.128-2.766-1.827 0-2.139 1.317-2.139 2.676V19.5h-3.19V8.796h3.168ZM7.2 6.106a1.61 1.61 0 0 1-.988 1.483 1.595 1.595 0 0 1-1.743-.348A1.607 1.607 0 0 1 5.6 4.5a1.601 1.601 0 0 1 1.6 1.606Z"
                clip-rule="evenodd" />
              <path d="M7.2 8.809H4V19.5h3.2V8.809Z" />
            </svg>

          </a>
          <a href="https://www.youtube.com/@nhvn4926" target="_blank" class="social-link"
            aria-label="YouTube Channel">
            <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
              width="35" height="35" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd"
                d="M21.7 8.037a4.26 4.26 0 0 0-.789-1.964 2.84 2.84 0 0 0-1.984-.839c-2.767-.2-6.926-.2-6.926-.2s-4.157 0-6.928.2a2.836 2.836 0 0 0-1.983.839 4.225 4.225 0 0 0-.79 1.965 30.146 30.146 0 0 0-.2 3.206v1.5a30.12 30.12 0 0 0 .2 3.206c.094.712.364 1.39.784 1.972.604.536 1.38.837 2.187.848 1.583.151 6.731.2 6.731.2s4.161 0 6.928-.2a2.844 2.844 0 0 0 1.985-.84 4.27 4.27 0 0 0 .787-1.965 30.12 30.12 0 0 0 .2-3.206v-1.516a30.672 30.672 0 0 0-.202-3.206Zm-11.692 6.554v-5.62l5.4 2.819-5.4 2.801Z"
                clip-rule="evenodd" />
            </svg>

          </a>

        </div>


      </section>
      <section class="animate-sec">

        <div class="cloud-ct">
          <div class="building building1"></div>
          <div class="building building2"></div>
          <div class="building roof"></div>
          <div class="building building3"></div>
          <div class="building building4"></div>

          <div class="cloud1">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
          </div>

          <div class="cloud2">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
          </div>

          <div class="cloud3">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
          </div>

        </div>
      </section>
    </div>
  </footer>
</body>

</html>